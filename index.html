<!-- OPEN GRAPH TAGS -->
<meta property="og:title" content="Archivist Shared Folder" />
<meta property="og:description" content="Click to import this folder into your Archivist app." />
<meta property="og:image" content="https://boblothian.github.io/archivist-share/icon.png" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://boblothian.github.io/archivist-share" />

<style>
    body { font-family: sans-serif; text-align: center; padding: 40px; color: #333; }
    .btn { display: inline-block; background: #007AFF; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; margin-top: 20px; font-weight: bold;}
    img { width: 120px; height: 120px; margin-bottom: 20px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
</style>

<!-- This new element will display a message to the user -->
<div id="message" style="display: none; margin-top: 20px; padding: 10px; border-radius: 8px; background-color: #f0f0f0;">
    <p>Trying to open Archivist... If the app doesn't open in a few seconds, you may not have it installed.</p>
</div>

<script>
    window.onload = function() {
        var params = new URLSearchParams(window.location.search);
        var data = params.get("data");
        
        var iosStore = "https://apps.apple.com/gb/app/archivist-browser/id6756570654";
        var androidStore = "https://play.google.com/store/apps/details?id=com.monodivision.archivist&pcampaignid=web_share";
        
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        var isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
        var isAndroid = /android/i.test(userAgent);

        var storeUrl = "";
        var btn = document.getElementById("dl-btn");
        if (isIOS) {
            btn.href = iosStore;
            storeUrl = iosStore;
            btn.innerText = "Download on App Store";
        } else if (isAndroid) {
            btn.href = androidStore;
            storeUrl = androidStore;
            btn.innerText = "Get it on Google Play";
        }

        // Try to open the app and set up fallback
        if (data) {
            var customScheme = "archivist://shared-folder?data=" + data;
            
            // Show the message element
            var messageEl = document.getElementById("message");
            if (messageEl) {
                messageEl.style.display = 'block';
            }
            
            // Attempt to navigate to the custom scheme
            window.location.href = customScheme;
            
            // Fallback to the appropriate app store after 15 seconds
            setTimeout(function() {
                // If the user is still on this page, the app likely didn't open.
                if (storeUrl) {
                    window.location.href = storeUrl;
                }
            }, 15000); // 15 seconds
        }
    };
</script>
